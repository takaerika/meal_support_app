<%# ===== 月の決定（URLの ?year=YYYY&month=MM を優先） ===== %>
<%
  today = Time.zone.today
  year  = params[:year].presence&.to_i || today.year
  month = params[:month].presence&.to_i || today.month

  begin
    current_month = Date.new(year, month, 1)
  rescue ArgumentError
    current_month = Date.new(today.year, today.month, 1)
  end

  prev_month = (current_month << 1) # 前月
  next_month = (current_month >> 1) # 翌月

  # カレンダー描画用の値
  first_wday = current_month.wday                       # 月初の曜日(0=日)
  last_day   = (current_month.next_month - 1).day       # 月末日
%>

<div class="container">

  <%# ==== ヘッダー ==== %>
  <header class="header">
    <h1>食事のきろく</h1>
    <div class="user-info">
      こんにちは、<%= current_user.full_name %> さん
    </div>
  </header>

  <%# ==== 目標（任意・仮） ==== %>
  <section class="goal-section">
    <h2>今月の目標：間食をやめる！</h2>
  </section>

  <%# ==== カレンダー ==== %>
  <div class="calendar-header">
    <%= link_to "◀︎", root_path(year: @prev_month.year, month: @prev_month.month), class: "month-nav" %>
    <h3><%= @month.strftime("%Y年 %-m月") %></h3>
  <%= link_to "▶︎", root_path(year: @next_month.year, month: @next_month.month), class: "month-nav" %>
  </div>

  <div id="calendar"
     class="calendar"
     data-year="<%= @month.year %>"
     data-month="<%= @month.month %>">

  <!-- 曜日ヘッダ -->
  <div class="day-name">日</div><div class="day-name">月</div><div class="day-name">火</div>
  <div class="day-name">水</div><div class="day-name">木</div><div class="day-name">金</div><div class="day-name">土</div>

  <!-- 先頭の空マス -->
  <% @first_wday.times do %>
    <div class="empty"></div>
  <% end %>

  <!-- 日付セル -->
  <% 1.upto(@last_day) do |d| %>
    <% date_obj = Date.new(@month.year, @month.month, d) %>
    <% is_today = (date_obj == Time.zone.today) %>
    <div class="day-cell <%= 'today' if is_today %>" data-day="<%= d %>">
      <span class="day-number"><%= d %></span>
    </div>
  <% end %>
</div>

  <%# ==== アクション ==== %>
  <div class="actions">
    <a href="#" class="action-button" id="recordButton">今日の食事を記録する</a>
  </div>

  <%# ==== （任意）新着コメントのエリア（仮） ==== %>
  <%# 実データに接続したら差し替え %>
  <section class="comment-section">
    <p><strong>サポーターからの新着コメント🔔</strong></p>
    <p>「昨日の夕食、野菜が多くて素晴らしいですね！」</p>
  </section>

  <%# タブバーに被らない余白（共通タブバー使用時） %>
  <div style="height: 80px"></div>
</div>

<%# ====== 簡易スタイル（MVP用／後でCSSに切り出し） ====== %>
<style>
  .container { max-width: 820px; margin: 0 auto; background:#fff; padding:16px; border-radius:8px; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:16px; }
  .header h1 { font-size:20px; margin:0; color:#2c5e46; }
  .goal-section { background:#e6f3ed; padding:12px; border-radius:8px; margin-bottom:16px; }
  .goal-section h2 { margin:0; font-size:16px; color:#2c5e46; }

  .calendar-header { display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:8px; }
  .calendar-header h3 { margin:0; }
  .month-nav { text-decoration:none; font-size:18px; padding:4px 8px; }

  .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; }
  .day-name { font-weight:bold; text-align:center; background:transparent; border:none; }
  .empty { background:transparent; }

  .day-cell { padding:10px; background:#f9f9f9; border:1px solid #ddd; border-radius:6px; cursor:pointer; min-height:56px; position:relative; }
  .day-cell:hover { background:#f1f5f1; }
  .day-cell.today { background:#a0d4b5; color:#fff; font-weight:bold; }
  .day-number { position:absolute; top:6px; right:8px; font-size:12px; }

  .actions { text-align:center; margin-top:18px; }
  .action-button { display:inline-block; padding:12px 20px; background:#4CAF50; color:#fff; border-radius:9999px; text-decoration:none; font-weight:700; }
  .action-button:hover { background:#45a049; }

  .comment-section { margin-top:18px; padding:12px; background:#fffbeb; border:1px solid #fdd835; border-radius:8px; }
</style>
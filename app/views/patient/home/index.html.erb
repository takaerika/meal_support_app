<%# ===== æœˆã®æ±ºå®šï¼ˆURLã® ?year=YYYY&month=MM ã‚’å„ªå…ˆï¼‰ ===== %>
<%
  today = Time.zone.today
  year  = params[:year].presence&.to_i || today.year
  month = params[:month].presence&.to_i || today.month

  begin
    current_month = Date.new(year, month, 1)
  rescue ArgumentError
    current_month = Date.new(today.year, today.month, 1)
  end

  prev_month = (current_month << 1) # å‰æœˆ
  next_month = (current_month >> 1) # ç¿Œæœˆ

  # ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»ç”¨ã®å€¤
  first_wday = current_month.wday                       # æœˆåˆã®æ›œæ—¥(0=æ—¥)
  last_day   = (current_month.next_month - 1).day       # æœˆæœ«æ—¥
%>

<div class="container">

  <%# ==== ãƒ˜ãƒƒãƒ€ãƒ¼ ==== %>
  <header class="header">
    <h1>é£Ÿäº‹ã®ãã‚ã</h1>
    <div class="user-info">
      ã“ã‚“ã«ã¡ã¯ã€<%= current_user.full_name %> ã•ã‚“
    </div>
  </header>

  <%# ==== ç›®æ¨™ï¼ˆä»»æ„ãƒ»ä»®ï¼‰ ==== %>
  <section class="goal-section">
    <h2>ä»Šæœˆã®ç›®æ¨™ï¼šé–“é£Ÿã‚’ã‚„ã‚ã‚‹ï¼</h2>
  </section>

  <%# ==== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ==== %>
  <div class="calendar-header">
    <%= link_to "â—€ï¸", root_path(year: @prev_month.year, month: @prev_month.month), class: "month-nav" %>
    <h3><%= @month.strftime("%Yå¹´ %-mæœˆ") %></h3>
  <%= link_to "â–¶ï¸", root_path(year: @next_month.year, month: @next_month.month), class: "month-nav" %>
  </div>

  <div id="calendar"
     class="calendar"
     data-year="<%= @month.year %>"
     data-month="<%= @month.month %>">

  <!-- æ›œæ—¥ãƒ˜ãƒƒãƒ€ -->
  <div class="day-name">æ—¥</div><div class="day-name">æœˆ</div><div class="day-name">ç«</div>
  <div class="day-name">æ°´</div><div class="day-name">æœ¨</div><div class="day-name">é‡‘</div><div class="day-name">åœŸ</div>

  <!-- å…ˆé ­ã®ç©ºãƒã‚¹ -->
  <% @first_wday.times do %>
    <div class="empty"></div>
  <% end %>

  <!-- æ—¥ä»˜ã‚»ãƒ« -->
  <% 1.upto(@last_day) do |d| %>
    <% date_obj = Date.new(@month.year, @month.month, d) %>
    <% is_today = (date_obj == Time.zone.today) %>
    <div class="day-cell <%= 'today' if is_today %>" data-day="<%= d %>">
      <span class="day-number"><%= d %></span>
    </div>
  <% end %>
</div>

  <%# ==== ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ==== %>
  <div class="actions">
    <a href="#" class="action-button" id="recordButton">ä»Šæ—¥ã®é£Ÿäº‹ã‚’è¨˜éŒ²ã™ã‚‹</a>
  </div>

  <%# ==== ï¼ˆä»»æ„ï¼‰æ–°ç€ã‚³ãƒ¡ãƒ³ãƒˆã®ã‚¨ãƒªã‚¢ï¼ˆä»®ï¼‰ ==== %>
  <%# å®Ÿãƒ‡ãƒ¼ã‚¿ã«æ¥ç¶šã—ãŸã‚‰å·®ã—æ›¿ãˆ %>
  <section class="comment-section">
    <p><strong>ã‚µãƒãƒ¼ã‚¿ãƒ¼ã‹ã‚‰ã®æ–°ç€ã‚³ãƒ¡ãƒ³ãƒˆğŸ””</strong></p>
    <p>ã€Œæ˜¨æ—¥ã®å¤•é£Ÿã€é‡èœãŒå¤šãã¦ç´ æ™´ã‚‰ã—ã„ã§ã™ã­ï¼ã€</p>
  </section>

  <%# ã‚¿ãƒ–ãƒãƒ¼ã«è¢«ã‚‰ãªã„ä½™ç™½ï¼ˆå…±é€šã‚¿ãƒ–ãƒãƒ¼ä½¿ç”¨æ™‚ï¼‰ %>
  <div style="height: 80px"></div>
</div>

<%# ====== ç°¡æ˜“ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆMVPç”¨ï¼å¾Œã§CSSã«åˆ‡ã‚Šå‡ºã—ï¼‰ ====== %>
<style>
  .container { max-width: 820px; margin: 0 auto; background:#fff; padding:16px; border-radius:8px; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:16px; }
  .header h1 { font-size:20px; margin:0; color:#2c5e46; }
  .goal-section { background:#e6f3ed; padding:12px; border-radius:8px; margin-bottom:16px; }
  .goal-section h2 { margin:0; font-size:16px; color:#2c5e46; }

  .calendar-header { display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:8px; }
  .calendar-header h3 { margin:0; }
  .month-nav { text-decoration:none; font-size:18px; padding:4px 8px; }

  .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; }
  .day-name { font-weight:bold; text-align:center; background:transparent; border:none; }
  .empty { background:transparent; }

  .day-cell { padding:10px; background:#f9f9f9; border:1px solid #ddd; border-radius:6px; cursor:pointer; min-height:56px; position:relative; }
  .day-cell:hover { background:#f1f5f1; }
  .day-cell.today { background:#a0d4b5; color:#fff; font-weight:bold; }
  .day-number { position:absolute; top:6px; right:8px; font-size:12px; }

  .actions { text-align:center; margin-top:18px; }
  .action-button { display:inline-block; padding:12px 20px; background:#4CAF50; color:#fff; border-radius:9999px; text-decoration:none; font-weight:700; }
  .action-button:hover { background:#45a049; }

  .comment-section { margin-top:18px; padding:12px; background:#fffbeb; border:1px solid #fdd835; border-radius:8px; }
</style>